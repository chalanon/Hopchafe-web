<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>‡∏ï‡∏¥‡∏î‡∏ï‡∏≤‡∏°‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏≠‡∏≠‡πÄ‡∏î‡∏≠‡∏£‡πå | Hopchafe</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
  <style>
    :root {
      --primary: #6a4c38;
      --accent: #b77b4c;
      --secondary: #fffbe9;
      --success: #43a047;
      --danger: #e53935;
      --info: #1976d2;
    }
    @import url('https://fonts.googleapis.com/css2?family=Kanit:wght@400;700;900&display=swap');
    body {
      font-family: 'Kanit', 'Sarabun', sans-serif;
      background: linear-gradient(135deg, var(--secondary) 0%, #e9e5dc 40%, #c0a98e 100%);
      margin: 0; padding: 0; min-height: 100vh;
      position: relative;
    }
    .bg-pattern {
      position: fixed; top: 0; left: 0; width: 100vw; height: 100vh;
      z-index: 0; pointer-events: none;
      background: url('https://www.transparenttextures.com/patterns/food.png');
      opacity: 0.07; mix-blend-mode: multiply;
    }
    .container {
      max-width: 540px; margin: 48px auto 0 auto;
      background: #fff;
      padding: 2.5rem 2rem 2rem 2rem;
      border-radius: 32px;
      box-shadow: 0 8px 32px #b77b4c22, 0 2px 8px #0001;
      position: relative;
      z-index: 1;
      animation: fadeInUp 0.8s cubic-bezier(.4,1.4,.6,1) both;
    }
    @keyframes fadeInUp {
      from { opacity: 0; transform: translateY(40px);}
      to { opacity: 1; transform: none;}
    }
    h2 {
      color: var(--primary);
      text-align: center;
      font-size: 2.1rem;
      font-weight: 900;
      letter-spacing: 1.5px;
      margin-bottom: 2.2rem;
      text-shadow: 0 2px 8px #c0a98e33;
    }
    .order-timeline {
      display: flex;
      flex-direction: column;
      gap: 2.2rem;
      margin-top: 1.2rem;
    }
    .order-card {
      background: #fff;
      border-radius: 22px;
      box-shadow: 0 2px 12px #b77b4c22;
      padding: 1.2rem 1.5rem 1.1rem 1.5rem;
      position: relative;
      display: flex;
      align-items: flex-start;
      gap: 1.2rem;
      border-left: 6px solid var(--accent);
      animation: fadeInOrder 0.7s cubic-bezier(.4,1.4,.6,1) both;
    }
    @keyframes fadeInOrder {
      from { opacity: 0; transform: translateY(30px);}
      to { opacity: 1; transform: none;}
    }
    .order-icon {
      font-size: 2.1rem;
      color: #b77b4c;
      margin-top: 0.2rem;
      flex-shrink: 0;
      filter: drop-shadow(0 2px 8px #b77b4c22);
    }
    .order-info {
      flex: 1;
    }
    .order-id {
      font-size: 1.08rem;
      font-weight: 700;
      color: var(--primary);
      margin-bottom: 0.2em;
      letter-spacing: 0.5px;
      word-break: break-all;
    }
    .order-status {
      font-size: 1.08rem;
      font-weight: 600;
      color: var(--accent);
      margin-bottom: 0.2em;
      display: flex; align-items: center; gap: 0.5em;
    }
    .order-status .fa {
      font-size: 1.1em;
      margin-right: 0.2em;
    }
    .order-time {
      color: #888;
      font-size: 0.98rem;
      margin-top: 0.2em;
    }
    .order-card::before {
      content: '';
      position: absolute;
      left: -13px; top: 24px;
      width: 18px; height: 18px;
      background: linear-gradient(135deg,#b77b4c 60%,#c0a98e 100%);
      border-radius: 50%;
      box-shadow: 0 2px 8px #b77b4c33;
      border: 2.5px solid #fff;
    }
    .empty-order {
      text-align: center;
      color: #aaa;
      font-size: 1.15rem;
      margin-top: 2.5rem;
    }
    .refresh-btn {
      display: block; margin: 2.5rem auto 0 auto; background: linear-gradient(90deg,var(--accent) 60%,var(--primary) 100%); color: white;
      padding: 0.7rem 2.2rem; border: none; border-radius: 24px; font-size: 1.1rem; cursor: pointer;
      font-weight: 700; box-shadow: 0 2px 8px #b77b4c33; transition: background 0.2s, box-shadow 0.2s;
    }
    .refresh-btn:hover {
      background: linear-gradient(90deg,var(--primary) 60%,var(--accent) 100%);
      box-shadow: 0 4px 16px #b77b4c55;
    }
    @media (max-width: 600px) {
      .container { padding: 1.2rem 0.2rem; }
      .order-card { padding: 1rem 0.5rem 1rem 0.8rem; }
    }
  </style>
</head>
<body>
  <div class="bg-pattern"></div>
  <div class="container">
    <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:1.2rem;">
      <h2 style="margin-bottom:0;"><i class="fa-solid fa-truck"></i> ‡∏ï‡∏¥‡∏î‡∏ï‡∏≤‡∏°‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏≠‡∏≠‡πÄ‡∏î‡∏≠‡∏£‡πå‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì</h2>
      <a href="order_history.html" class="history-btn" style="background:linear-gradient(90deg,#b77b4c 60%,#6a4c38 100%);color:#fff;padding:0.6rem 1.5rem;border-radius:24px;font-size:1.08rem;font-weight:600;text-decoration:none;box-shadow:0 2px 8px #b77b4c33;transition:background 0.2s;display:inline-block;">
        <i class="fa-solid fa-receipt"></i> ‡∏î‡∏π‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏Å‡∏≤‡∏£‡∏™‡∏±‡πà‡∏á‡∏ã‡∏∑‡πâ‡∏≠
      </a>
    </div>
    <div id="order-list"><div class="empty-order">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î...</div></div>
    <div id="etaDisplay" style="color:#1976d2;font-weight:600;margin:1.2rem 0 0.5rem 0;"></div>
    <button class="refresh-btn" id="manual-refresh"><i class="fa-solid fa-arrows-rotate"></i> ‡∏£‡∏µ‡πÄ‡∏ü‡∏£‡∏ä‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£</button>
    <div id="auto-refresh-msg" style="text-align:center;color:#b77b4c;font-size:0.98rem;margin-top:0.7rem;opacity:0.7;">‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏à‡∏∞‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥‡∏ó‡∏∏‡∏Å 10 ‡∏ß‡∏¥‡∏ô‡∏≤‡∏ó‡∏µ</div>
    <div style="display:flex;gap:1rem;justify-content:space-between;margin:1.2rem 0 0.5rem 0;">
      <a href="tel:0999999999" style="background:#43a047;color:#fff;padding:0.7rem 1.2rem;border-radius:12px;text-decoration:none;font-weight:700;box-shadow:0 2px 8px #43a04733;display:inline-block;">üìû ‡πÇ‡∏ó‡∏£‡∏£‡πâ‡∏≤‡∏ô</a>
      <button id="helpBtn" style="background:#1976d2;color:#fff;padding:0.7rem 1.2rem;border:none;border-radius:12px;font-weight:700;box-shadow:0 2px 8px #1976d233;cursor:pointer;">‚ùì ‡∏ä‡πà‡∏ß‡∏¢‡πÄ‡∏´‡∏•‡∏∑‡∏≠/FAQ</button>
    </div>
    <div id="loader" style="display:none;justify-content:center;align-items:center;position:fixed;top:0;left:0;width:100vw;height:100vh;background:rgba(255,255,255,0.7);z-index:9999;">
      <div style="background:#fff;padding:2rem 2.5rem;border-radius:18px;box-shadow:0 2px 12px #b77b4c33;text-align:center;">
        <div class="lds-dual-ring" style="margin-bottom:1rem;"></div>
        <div style="font-weight:700;color:#6a4c38;">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•...</div>
      </div>
    </div>
    <style>
      .lds-dual-ring {
        display: inline-block;
        width: 48px;
        height: 48px;
      }
      .lds-dual-ring:after {
        content: " ";
        display: block;
        width: 38px;
        height: 38px;
        margin: 5px;
        border-radius: 50%;
        border: 6px solid #b77b4c;
        border-color: #b77b4c transparent #b77b4c transparent;
        animation: lds-dual-ring 1.2s linear infinite;
      }
      @keyframes lds-dual-ring {
        0% { transform: rotate(0deg); }
        100% { transform: rotate(360deg); }
      }
    </style>
  </div>
  <script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/11.10.0/firebase-app.js";
import { getAuth, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/11.10.0/firebase-auth.js";
import { getFirestore, collection, query, where, onSnapshot, orderBy, getDocs } from "https://www.gstatic.com/firebasejs/11.10.0/firebase-firestore.js";

const firebaseConfig = {
  apiKey: "AIzaSyDlNofFy2Q0xZNrQRGdTT-7Tf3ELoL4gZg",
  authDomain: "hopchafe-184ad.firebaseapp.com",
  projectId: "hopchafe-184ad",
  storageBucket: "hopchafe-184ad.appspot.com",
  messagingSenderId: "314546539339",
  appId: "1:314546539339:web:22b31673662662f27236ce"
};
const app = initializeApp(firebaseConfig);
const db = getFirestore(app);
const auth = getAuth(app);

  import { doc, getDoc } from "https://www.gstatic.com/firebasejs/11.10.0/firebase-firestore.js";
  let unsubscribe = null;
  let autoRefreshTimer = null;
  // ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏≠‡∏±‡∏û‡πÄ‡∏î‡∏ó‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥
  async function autoUpdateStatus(orderId, currentStatus, orderType) {
    const statusSteps = orderType === 'delivery' ? 
      ['‡∏£‡∏≠‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£', '‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏à‡∏±‡∏î‡πÄ‡∏ï‡∏£‡∏µ‡∏¢‡∏°', '‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏à‡∏±‡∏î‡∏™‡πà‡∏á', '‡∏à‡∏±‡∏î‡∏™‡πà‡∏á‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à'] :
      ['‡∏£‡∏≠‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£', '‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏à‡∏±‡∏î‡πÄ‡∏ï‡∏£‡∏µ‡∏¢‡∏°', '‡∏û‡∏£‡πâ‡∏≠‡∏°‡∏£‡∏±‡∏ö‡∏ó‡∏µ‡πà‡∏£‡πâ‡∏≤‡∏ô', '‡∏£‡∏±‡∏ö‡∏ó‡∏µ‡πà‡∏£‡πâ‡∏≤‡∏ô‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à'];
    
    const currentIndex = statusSteps.indexOf(currentStatus);
    if (currentIndex === -1 || currentIndex >= statusSteps.length - 1) return;

    const nextStatus = statusSteps[currentIndex + 1];
    const timeouts = [15000, 30000, 45000]; // 15, 30, 45 ‡∏ß‡∏¥‡∏ô‡∏≤‡∏ó‡∏µ ‡∏ï‡∏≤‡∏°‡∏•‡∏≥‡∏î‡∏±‡∏ö

    try {
      setTimeout(async () => {
        await db.collection('orders').doc(orderId).update({
          status: nextStatus,
          updated: new Date()
        });

        // ‡πÅ‡∏™‡∏î‡∏á‡∏Å‡∏≤‡∏£‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô
        const notification = document.createElement('div');
        notification.style.cssText = `
          position: fixed;
          top: 20px;
          right: 20px;
          background: var(--accent);
          color: white;
          padding: 1rem;
          border-radius: 8px;
          box-shadow: 0 2px 12px rgba(0,0,0,0.2);
          animation: fadeInRight 0.5s ease;
          z-index: 1000;
        `;
        notification.innerHTML = `<i class="fas fa-info-circle"></i> ‡∏≠‡∏±‡∏û‡πÄ‡∏î‡∏ó‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡πÄ‡∏õ‡πá‡∏ô: ${nextStatus}`;
        document.body.appendChild(notification);
        setTimeout(() => notification.remove(), 3000);

        // ‡πÄ‡∏£‡∏µ‡∏¢‡∏Å‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏≠‡∏µ‡∏Å‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏ñ‡∏±‡∏î‡πÑ‡∏õ
        if (nextStatus !== statusSteps[statusSteps.length - 1]) {
          autoUpdateStatus(orderId, nextStatus, orderType);
        }
      }, timeouts[currentIndex]);
    } catch (error) {
      console.error('Error updating status:', error);
    }
  }

  function renderOrders(snapshot, orderList) {
    if (snapshot.empty) {
      orderList.innerHTML = '<div class="empty-order">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏≠‡∏≠‡πÄ‡∏î‡∏≠‡∏£‡πå</div>';
      return;
    }
    orderList.innerHTML = '<div class="order-timeline"></div>';
    const timeline = orderList.querySelector('.order-timeline');
    snapshot.forEach(docSnap => {
      const data = docSnap.data();
      const orderId = docSnap.id;

      // ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏≠‡∏±‡∏û‡πÄ‡∏î‡∏ó‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏≠‡∏≠‡πÄ‡∏î‡∏≠‡∏£‡πå‡πÉ‡∏´‡∏°‡πà
      if (data.status === '‡∏£‡∏≠‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£') {
        autoUpdateStatus(orderId, data.status, data.orderType || 'delivery');
      }
      // ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÑ‡∏≠‡∏Ñ‡∏≠‡∏ô‡∏ï‡∏≤‡∏°‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞
      let statusIcon = '<i class="fa-solid fa-hourglass-half"></i>';
      let statusColor = '#b77b4c';
      let highlight = '';
      if (data.status && (data.status.includes('‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à') || data.status.includes('‡∏à‡∏±‡∏î‡∏™‡πà‡∏á‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à'))) {
        statusIcon = '<i class="fa-solid fa-circle-check"></i>';
        statusColor = '#43a047';
        highlight = 'order-success';
      } else if (data.status && data.status.includes('‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å')) {
        statusIcon = '<i class="fa-solid fa-circle-xmark"></i>';
        statusColor = '#e53935';
        highlight = 'order-cancel';
      } else if (data.status && data.status.includes('‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏à‡∏±‡∏î‡∏™‡πà‡∏á')) {
        statusIcon = '<i class="fa-solid fa-truck"></i>';
        statusColor = '#1976d2';
      }
      const div = document.createElement('div');
      div.className = 'order-card ' + highlight;
      
      // ‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡πÄ‡∏ß‡∏•‡∏≤‡∏ó‡∏µ‡πà‡πÄ‡∏´‡∏•‡∏∑‡∏≠‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡∏≠‡∏±‡∏û‡πÄ‡∏î‡∏ó‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏ñ‡∏±‡∏î‡πÑ‡∏õ
      let timeLeftText = '';
      if (!data.status?.includes('‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à') && !data.status?.includes('‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å')) {
        const currentIndex = (data.orderType === 'pickup' ? 
          ['‡∏£‡∏≠‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£', '‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏à‡∏±‡∏î‡πÄ‡∏ï‡∏£‡∏µ‡∏¢‡∏°', '‡∏û‡∏£‡πâ‡∏≠‡∏°‡∏£‡∏±‡∏ö‡∏ó‡∏µ‡πà‡∏£‡πâ‡∏≤‡∏ô', '‡∏£‡∏±‡∏ö‡∏ó‡∏µ‡πà‡∏£‡πâ‡∏≤‡∏ô‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à'] :
          ['‡∏£‡∏≠‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£', '‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏à‡∏±‡∏î‡πÄ‡∏ï‡∏£‡∏µ‡∏¢‡∏°', '‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏à‡∏±‡∏î‡∏™‡πà‡∏á', '‡∏à‡∏±‡∏î‡∏™‡πà‡∏á‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à']
        ).indexOf(data.status);

        if (currentIndex >= 0 && currentIndex < 3) {
          const timeouts = [15, 30, 45];
          timeLeftText = `<div style="color:#1976d2;font-size:0.9rem;margin-top:0.3rem;">
            ‡∏≠‡∏µ‡∏Å‡∏õ‡∏£‡∏∞‡∏°‡∏≤‡∏ì ${timeouts[currentIndex]} ‡∏ß‡∏¥‡∏ô‡∏≤‡∏ó‡∏µ ‡∏à‡∏∞‡∏≠‡∏±‡∏û‡πÄ‡∏î‡∏ó‡πÄ‡∏õ‡πá‡∏ô‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏ñ‡∏±‡∏î‡πÑ‡∏õ
          </div>`;
        }
      }

      div.innerHTML = `
        <div class="order-icon">${statusIcon}</div>
        <div class="order-info">
          <div class="order-id">Order: <span style="color:#b77b4c;">${orderId}</span></div>
          <div class="order-status" style="color:${statusColor};font-size:1.13rem;">
            ${statusIcon} ${data.status || '-'}
            ${(highlight==='order-success') ? '<span style="margin-left:0.5em;color:#43a047;font-weight:700;">‚úî ‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à</span>' : ''}
            ${(highlight==='order-cancel') ? '<span style="margin-left:0.5em;color:#e53935;font-weight:700;">‚úñ ‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å</span>' : ''}
          </div>
          <div style="color:#666;margin-top:0.2rem;">
            ${data.orderType === 'pickup' ? 'üìç ‡∏£‡∏±‡∏ö‡∏ó‡∏µ‡πà‡∏£‡πâ‡∏≤‡∏ô' : 'üöö ‡∏à‡∏±‡∏î‡∏™‡πà‡∏á'}
          </div>
          <div class="order-time">
            ‡∏™‡∏±‡πà‡∏á‡πÄ‡∏°‡∏∑‡πà‡∏≠: ${data.created ? new Date(data.created.seconds*1000).toLocaleString('th-TH') : '-'}
          </div>
          ${timeLeftText}
        </div>
      `;
      timeline.appendChild(div);
    });
  }

  onAuthStateChanged(auth, async user => {
    document.getElementById('loader').style.display = 'flex';
    const orderList = document.getElementById('order-list');
    if (!user) {
      document.getElementById('loader').style.display = 'none';
      orderList.innerHTML = '<div class="empty-order" style="color:#e53935;">‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö‡∏Å‡πà‡∏≠‡∏ô</div>';
      return;
    }
    // ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö role ‡∏Å‡πà‡∏≠‡∏ô
    const userDoc = await getDoc(doc(db, 'users', user.uid));
    const userData = userDoc.exists() ? userDoc.data() : {};
    const role = userData.role || '';
    if (role === 'admin' || role === '‡∏ú‡∏π‡πâ‡∏î‡∏π‡πÅ‡∏•‡∏£‡πâ‡∏≤‡∏ô') {
      document.getElementById('loader').style.display = 'none';
      window.location.href = 'admin_dashboard.html';
      return;
    }
    // ‡∏î‡∏∂‡∏á‡∏≠‡∏≠‡πÄ‡∏î‡∏≠‡∏£‡πå‡∏Ç‡∏≠‡∏á user
    const q = query(collection(db, 'orders'), where('userId', '==', user.uid), orderBy('created', 'desc'));
    if (unsubscribe) unsubscribe();
    unsubscribe = onSnapshot(q, snapshot => {
      renderOrders(snapshot, orderList);
      document.getElementById('loader').style.display = 'none';
    });
    // ETA (‡πÄ‡∏ß‡∏•‡∏≤‡∏õ‡∏£‡∏∞‡∏°‡∏≤‡∏ì‡∏Å‡∏≤‡∏£‡∏à‡∏±‡∏î‡∏™‡πà‡∏á)
    const etaDiv = document.getElementById('etaDisplay');
    function updateEta() {
      // ‡∏õ‡∏£‡∏∞‡πÄ‡∏°‡∏¥‡∏ô ETA ‡∏à‡∏≤‡∏Å‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î
      const orderCards = document.querySelectorAll('.order-card');
      if (!orderCards.length) { etaDiv.textContent = ''; return; }
      // ‡∏™‡∏°‡∏°‡∏∏‡∏ï‡∏¥ ETA ‡∏à‡∏≤‡∏Å‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î‡∏Ç‡∏≠‡∏á order ‡πÅ‡∏£‡∏Å
      const status = orderCards[0].querySelector('.order-status')?.textContent || '';
      let eta = '-';
      if (status.includes('‡∏£‡∏±‡∏ö‡πÄ‡∏≠‡∏á')) eta = '‡∏õ‡∏£‡∏∞‡∏°‡∏≤‡∏ì 5-10 ‡∏ô‡∏≤‡∏ó‡∏µ';
      else if (status.includes('‡∏à‡∏±‡∏î‡∏™‡πà‡∏á')) {
        if (status.includes('1 ‡∏Å‡∏°.')) eta = '‡∏õ‡∏£‡∏∞‡∏°‡∏≤‡∏ì 5 ‡∏ô‡∏≤‡∏ó‡∏µ';
        else if (status.includes('2 ‡∏Å‡∏°.')) eta = '‡∏õ‡∏£‡∏∞‡∏°‡∏≤‡∏ì 8 ‡∏ô‡∏≤‡∏ó‡∏µ';
        else eta = '‡∏õ‡∏£‡∏∞‡∏°‡∏≤‡∏ì 10 ‡∏ô‡∏≤‡∏ó‡∏µ';
      }
      etaDiv.textContent = '‡πÄ‡∏ß‡∏•‡∏≤‡∏õ‡∏£‡∏∞‡∏°‡∏≤‡∏ì‡∏Å‡∏≤‡∏£‡∏à‡∏±‡∏î‡∏™‡πà‡∏á: ' + eta;
    }
    setTimeout(updateEta, 1200);
    document.getElementById('order-list').addEventListener('DOMSubtreeModified', updateEta);

    // ‡∏õ‡∏∏‡πà‡∏°‡∏ä‡πà‡∏ß‡∏¢‡πÄ‡∏´‡∏•‡∏∑‡∏≠/FAQ
    document.getElementById('helpBtn').onclick = () => {
      alert('FAQ/‡∏ä‡πà‡∏ß‡∏¢‡πÄ‡∏´‡∏•‡∏∑‡∏≠\n\n- ‡∏ï‡∏¥‡∏î‡∏ï‡∏≤‡∏°‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞: ‡∏£‡∏∞‡∏ö‡∏ö‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥\n- ‡∏õ‡∏±‡∏ç‡∏´‡∏≤‡∏Å‡∏≤‡∏£‡∏à‡∏±‡∏î‡∏™‡πà‡∏á: ‡πÇ‡∏ó‡∏£ 099-999-9999\n- ‡πÄ‡∏ß‡∏•‡∏≤‡∏à‡∏±‡∏î‡∏™‡πà‡∏á: ‡∏õ‡∏£‡∏∞‡∏°‡∏≤‡∏ì 5-10 ‡∏ô‡∏≤‡∏ó‡∏µ\n- ‡∏ï‡∏¥‡∏î‡∏ï‡πà‡∏≠‡∏£‡πâ‡∏≤‡∏ô: ‡πÇ‡∏ó‡∏£ 099-999-9999');
    };
    // auto refresh (pull snapshot again every 10s)
    if (autoRefreshTimer) clearInterval(autoRefreshTimer);
    autoRefreshTimer = setInterval(async () => {
      const docsSnap = await getDocs(q);
      renderOrders(docsSnap, orderList);
    }, 10000);
    // manual refresh
    document.getElementById('manual-refresh').onclick = () => {
      getDocs(q).then(snap => renderOrders(snap, orderList));
    };
  });
  // ‡πÄ‡∏û‡∏¥‡πà‡∏° CSS ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡πÄ‡∏î‡πà‡∏ô
  const style = document.createElement('style');
  style.innerHTML = `
    .order-success { border-left: 6px solid #43a047 !important; box-shadow: 0 2px 16px #43a04722; animation: popSuccess 0.7s; }
    .order-cancel { border-left: 6px solid #e53935 !important; box-shadow: 0 2px 16px #e5393522; animation: popCancel 0.7s; }
    @keyframes popSuccess { 0%{transform:scale(0.97);} 60%{transform:scale(1.04);} 100%{transform:scale(1);} }
    @keyframes popCancel { 0%{transform:scale(0.97);} 60%{transform:scale(1.04);} 100%{transform:scale(1);} }
  `;
  document.head.appendChild(style);
</script>
</body>
</html>